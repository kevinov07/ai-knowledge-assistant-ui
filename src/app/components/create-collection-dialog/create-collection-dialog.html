@if (open) {
  <div
    class="fixed inset-0 z-50 flex items-center justify-center p-4"
    role="dialog"
    aria-modal="true"
    aria-labelledby="dialog-title"
    aria-describedby="dialog-desc">
    <!-- Backdrop -->
    <div
      class="absolute inset-0 bg-black/50"
      (click)="handleOpenChange(false)">
    </div>

    <!-- Content -->
    <div
      class="relative z-10 w-full max-w-md rounded-xl border border-border bg-card shadow-lg"
      (click)="$event.stopPropagation()">
      <div class="p-6 pb-2">
        <h2 id="dialog-title" class="text-lg font-semibold text-foreground">
          New Collection
        </h2>
        <p id="dialog-desc" class="text-sm text-muted-foreground mt-1">
          Create a new knowledge base collection. Upload documents and chat with them.
        </p>
      </div>

      <div class="space-y-4 py-4 px-6">
        <!-- Name -->
        <div class="space-y-2">
          <label for="collection-name" class="text-sm text-foreground block">
            Name
          </label>
          <input
            id="collection-name"
            type="text"
            [(ngModel)]="name"
            placeholder="e.g. Q4 Financial Reports"
            class="w-full h-9 px-3 rounded-md bg-secondary border-0 text-sm text-foreground placeholder:text-muted-foreground focus:outline-none focus:ring-1 focus:ring-primary" />
        </div>

        <!-- Description -->
        <div class="space-y-2">
          <label for="collection-desc" class="text-sm text-foreground block">
            Description <span class="text-muted-foreground font-normal">(optional)</span>
          </label>
          <textarea
            id="collection-desc"
            [(ngModel)]="description"
            placeholder="Brief description of this collection..."
            rows="2"
            class="w-full px-3 py-2 rounded-md bg-secondary border-0 resize-none min-h-[72px] text-sm text-foreground placeholder:text-muted-foreground focus:outline-none focus:ring-1 focus:ring-primary"></textarea>
        </div>

        <!-- Privacy Toggle -->
        <div class="space-y-3">
          <span class="text-sm text-foreground block">Access</span>
          <div class="grid grid-cols-2 gap-2">
            <button
              type="button"
              (click)="isPublic = true"
              [class]="'flex items-center gap-2 rounded-lg border p-3 transition-all text-left w-full ' +
                (isPublic ? 'border-primary bg-primary/10 text-foreground' : 'border-border bg-secondary/50 text-muted-foreground hover:bg-secondary')">
              <lucide-icon [img]="FolderOpen" class="h-4 w-4 shrink-0" />
              <div>
                <p class="text-sm font-medium">Public</p>
                <p class="text-[11px] text-muted-foreground">Open access</p>
              </div>
            </button>
            <button
              type="button"
              (click)="isPublic = false"
              [class]="'flex items-center gap-2 rounded-lg border p-3 transition-all text-left w-full ' +
                (!isPublic ? 'border-primary bg-primary/10 text-foreground' : 'border-border bg-secondary/50 text-muted-foreground hover:bg-secondary')">
              <lucide-icon [img]="Lock" class="h-4 w-4 shrink-0" />
              <div>
                <p class="text-sm font-medium">Private</p>
                <p class="text-[11px] text-muted-foreground">Code required</p>
              </div>
            </button>
          </div>
        </div>

        <!-- Code Field -->
        @if (!isPublic) {
          <div class="space-y-2">
            <label for="collection-code" class="text-sm text-foreground block">
              Access Code
            </label>
            <div class="relative">
              <input
                id="collection-code"
                [type]="showCode ? 'text' : 'password'"
                [(ngModel)]="code"
                placeholder="Enter access code"
                class="w-full h-9 pl-3 pr-10 rounded-md bg-secondary border-0 text-sm text-foreground placeholder:text-muted-foreground focus:outline-none focus:ring-1 focus:ring-primary" />
              <button
                type="button"
                (click)="toggleShowCode()"
                class="absolute right-1 top-1/2 -translate-y-1/2 h-7 w-7 flex items-center justify-center rounded text-muted-foreground hover:text-foreground"
                [attr.aria-label]="showCode ? 'Hide code' : 'Show code'">
                @if (showCode) {
                  <lucide-icon [img]="EyeOff" class="h-3.5 w-3.5" />
                } @else {
                  <lucide-icon [img]="Eye" class="h-3.5 w-3.5" />
                }
              </button>
            </div>
            <p class="text-[11px] text-muted-foreground">
              Others will need this code to access the collection.
            </p>
          </div>
        }
      </div>

      <!-- Footer -->
      <div class="flex justify-end gap-2 p-6 pt-2 border-t border-border">
        <button
          type="button"
          (click)="handleOpenChange(false)"
          class="px-4 py-2 text-sm rounded-md text-muted-foreground hover:bg-secondary hover:text-foreground transition-colors">
          Cancel
        </button>
        <button
          type="button"
          (click)="handleCreate()"
          [disabled]="!canCreate"
          class="px-4 py-2 text-sm font-medium rounded-md bg-primary text-primary-foreground hover:bg-primary/90 disabled:opacity-50 disabled:pointer-events-none transition-colors">
          Create Collection
        </button>
      </div>
    </div>
  </div>
}
